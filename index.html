<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VaultPro - Premium Finance</title>
    <meta name="description" content="Professional financial management platform with advanced analytics">
    <meta name="theme-color" content="#000000">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app" v-cloak>
        <!-- Loading Screen -->
        <div v-if="isLoading" class="loading-screen">
            <div class="loading-spinner"></div>
            <div class="loading-text">Securing your vault...</div>
        </div>

        <!-- Login Screen -->
        <div v-if="!currentUser && !isLoading" class="login-screen">
            <div class="login-container">
                <div class="brand-section">
                    <div class="brand-icon">V</div>
                    <div class="logo">VAULT<span class="logo-pro">PRO</span></div>
                    <div class="logo-sub">PREMIUM FINANCE PLATFORM</div>
                </div>
                
                <div class="login-form" :class="{ 'shake': loginError }">
                    <div class="input-group">
                        <input 
                            type="email" 
                            v-model="loginEmail" 
                            class="f-input" 
                            placeholder="Email Address"
                            :disabled="loggingIn"
                            @keyup.enter="login"
                            autocomplete="email"
                        >
                        <span class="input-icon">üìß</span>
                    </div>
                    
                    <div class="input-group">
                        <input 
                            :type="showPassword ? 'text' : 'password'" 
                            v-model="loginPass" 
                            class="f-input" 
                            placeholder="Password"
                            :disabled="loggingIn"
                            @keyup.enter="login"
                            autocomplete="current-password"
                        >
                        <span class="input-icon toggle-password" @click="showPassword = !showPassword">
                            {{ showPassword ? 'üôà' : 'üëÅÔ∏è' }}
                        </span>
                    </div>
                    
                    <button 
                        class="btn-primary" 
                        @click="login" 
                        :disabled="loggingIn || !loginEmail || !loginPass"
                        :class="{ 'loading': loggingIn }"
                    >
                        <span v-if="!loggingIn">Access Vault</span>
                        <span v-else class="btn-spinner">üîê</span>
                    </button>
                    
                    <div v-if="loginError" class="error-message">{{ loginError }}</div>
                </div>

                <div class="login-footer">
                    <div class="security-badge">
                        üõ°Ô∏è Bank-level encryption
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <template v-else-if="!isLoading">
            <header class="main-header">
                <div class="fintech-title">
                    Vault<span class="title-pro">Pro</span>
                </div>
                <div class="header-actions">
                    <div class="notification-bell" @click="showNotifications = !showNotifications">
                        üîî
                        <div v-if="unreadCount > 0" class="notification-badge">{{ unreadCount }}</div>
                    </div>
                    <div class="user-pill" @click="currentTab = 'profile'">
                        <div class="user-avatar" :style="{ background: userAvatarGradient }">
                            {{ currentUser.name[0] }}
                        </div>
                        <div class="user-info">
                            <span class="u-name">{{ currentUser.name }}</span>
                            <span class="u-role">{{ settings.role.toUpperCase() }}</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Notification Panel -->
            <div v-if="showNotifications" class="notification-panel" @click.self="showNotifications = false">
                <div class="notification-content">
                    <div class="notification-header">
                        <h3>Notifications</h3>
                        <button @click="showNotifications = false">‚úï</button>
                    </div>
                    <div class="notification-list">
                        <div v-for="notif in notifications" :key="notif.id" class="notification-item">
                            <div class="notif-icon">{{ notif.icon }}</div>
                            <div class="notif-content">
                                <div class="notif-title">{{ notif.title }}</div>
                                <div class="notif-time">{{ formatTime(notif.time) }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <main class="scroll-content">
                <!-- Home Dashboard -->
                <div v-if="currentTab === 'home'" class="tab-content">
                    <div class="dashboard-cards">
                        <div class="balance-card main-balance">
                            <div class="balance-header">
                                <div class="balance-info">
                                    <span class="label">TOTAL BALANCE</span>
                                    <span class="trend" :class="balanceTrend.direction">
                                        {{ balanceTrend.icon }} {{ balanceTrend.percentage }}%
                                    </span>
                                </div>
                                <div class="balance-controls">
                                    <button class="mini-btn" @click="refreshBalance">üîÑ</button>
                                </div>
                            </div>
                            <div class="amount-display">
                                <transition name="balance">
                                    <div :key="cashBalance" class="amount">
                                        {{ settings.currency }}{{ formatNumber(cashBalance) }}
                                    </div>
                                </transition>
                            </div>
                            <div class="balance-breakdown">
                                <div class="breakdown-item">
                                    <span class="breakdown-label">Income</span>
                                    <span class="breakdown-value positive">
                                        +{{ settings.currency }}{{ formatNumber(monthlyIncome) }}
                                    </span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">Expenses</span>
                                    <span class="breakdown-value negative">
                                        -{{ settings.currency }}{{ formatNumber(monthlyExpenses) }}
                                    </span>
                                </div>
                            </div>
                            <div class="progress-container">
                                <div class="p-bar">
                                    <div class="p-fill" :style="{ width: balanceProgress + '%' }"></div>
                                </div>
                                <div class="progress-label">Monthly Goal Progress</div>
                            </div>
                        </div>

                        <!-- Quick Stats Cards -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">üìä</div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ transactions.length }}</div>
                                    <div class="stat-label">Transactions</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">üìà</div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ averageTransaction }}</div>
                                    <div class="stat-label">Avg Amount</div>
                                </div>
                            </div>
                            
                            <div v-if="isAdmin" class="stat-card">
                                <div class="stat-icon">‚Çø</div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ cryptoHoldings }}</div>
                                    <div class="stat-label">Crypto Value</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="section-container">
                        <div class="section-header">
                            <span class="section-label">RECENT ACTIVITY</span>
                            <span class="section-action" @click="currentTab = 'list'">View All ‚Üí</span>
                        </div>

                        <div class="transaction-list">
                            <transition-group name="transaction" tag="div">
                                <div 
                                    v-for="t in recentTransactions" 
                                    :key="t.id" 
                                    class="t-item enhanced"
                                    @click="openEdit(t)"
                                >
                                    <div class="t-icon-box" :style="{ background: getCategoryColor(t.category) }">
                                        {{ getEmoji(t.category) }}
                                    </div>
                                    <div class="t-main">
                                        <div class="t-cat">{{ t.category }}</div>
                                        <div class="t-sub">
                                            <span class="t-date">{{ formatDate(t.date) }}</span>
                                            <span v-if="t.notes" class="t-note">‚Ä¢ {{ t.notes }}</span>
                                        </div>
                                    </div>
                                    <div class="t-amount-section">
                                        <div :class="['t-amt', isPositive(t.category) ? 'plus' : 'minus']">
                                            {{ isPositive(t.category) ? '+' : '-' }}{{ settings.currency }}{{ formatNumber(t.amount) }}
                                        </div>
                                        <div class="t-chevron">‚Ä∫</div>
                                    </div>
                                </div>
                            </transition-group>
                        </div>

                        <div v-if="transactions.length === 0" class="empty-state">
                            <div class="empty-icon">üí∞</div>
                            <div class="empty-title">Ready to track your finances?</div>
                            <div class="empty-subtitle">Tap the + button to add your first transaction</div>
                        </div>
                    </div>
                </div>

                <!-- Transaction List -->
                <div v-if="currentTab === 'list'" class="tab-content">
                    <div class="list-header">
                        <div class="section-header">
                            <span class="section-label">TRANSACTION HISTORY</span>
                            <div class="header-controls">
                                <button class="filter-btn" @click="showFilters = !showFilters">
                                    üîç Filter
                                </button>
                                <button class="sort-btn" @click="toggleSort">
                                    {{ sortOrder === 'desc' ? 'üìÖ‚Üì' : 'üìÖ‚Üë' }}
                                </button>
                            </div>
                        </div>

                        <!-- Filter Panel -->
                        <transition name="slide">
                            <div v-if="showFilters" class="filter-panel">
                                <div class="filter-row">
                                    <select v-model="filterCategory" class="filter-select">
                                        <option value="">All Categories</option>
                                        <option v-for="cat in allCategories" :value="cat">{{ cat }}</option>
                                    </select>
                                    <select v-model="filterMonth" class="filter-select">
                                        <option value="">All Time</option>
                                        <option v-for="month in availableMonths" :value="month.value">
                                            {{ month.label }}
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </transition>
                    </div>

                    <div class="transaction-list">
                        <transition-group name="transaction" tag="div">
                            <div 
                                v-for="t in filteredTransactions" 
                                :key="t.id" 
                                class="t-item enhanced"
                                @click="openEdit(t)"
                            >
                                <div class="t-icon-box" :style="{ background: getCategoryColor(t.category) }">
                                    {{ getEmoji(t.category) }}
                                </div>
                                <div class="t-main">
                                    <div class="t-cat">{{ t.category }}</div>
                                    <div class="t-sub">
                                        <span class="t-date">{{ formatDate(t.date) }}</span>
                                        <span v-if="t.notes" class="t-note">‚Ä¢ {{ t.notes }}</span>
                                        <span v-if="t.asset && isAdmin" class="t-asset">‚Ä¢ {{ t.asset }}</span>
                                    </div>
                                </div>
                                <div class="t-amount-section">
                                    <div :class="['t-amt', isPositive(t.category) ? 'plus' : 'minus']">
                                        {{ settings.currency }}{{ formatNumber(t.amount) }}
                                    </div>
                                    <div class="t-chevron">‚Ä∫</div>
                                </div>
                            </div>
                        </transition-group>
                    </div>
                </div>

                <!-- Crypto Dashboard (Admin Only) -->
                <div v-if="currentTab === 'crypto' && isAdmin" class="tab-content">
                    <div class="crypto-dashboard">
                        <div class="section-header">
                            <span class="section-label">CRYPTO PORTFOLIO</span>
                            <div class="crypto-value">
                                Total: {{ settings.currency }}{{ formatNumber(cryptoHoldings) }}
                            </div>
                        </div>

                        <div class="crypto-stats">
                            <div class="crypto-card">
                                <div class="crypto-icon">üêô</div>
                                <div class="crypto-info">
                                    <div class="crypto-title">Kraken Deposits</div>
                                    <div class="crypto-amount">
                                        {{ settings.currency }}{{ formatNumber(krakenTotal) }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="transaction-list">
                            <div 
                                v-for="t in cryptoTransactions" 
                                :key="t.id" 
                                class="t-item crypto-item"
                                @click="openEdit(t)"
                            >
                                <div class="t-icon-box crypto-icon-box">
                                    {{ getEmoji(t.category) }}
                                </div>
                                <div class="t-main">
                                    <div class="t-cat">
                                        {{ t.category }}
                                        <span v-if="t.asset" class="asset-tag">{{ t.asset }}</span>
                                    </div>
                                    <div class="t-sub">{{ formatDate(t.date) }}</div>
                                </div>
                                <div class="t-amount-section">
                                    <div class="t-amt crypto-amount">
                                        {{ settings.currency }}{{ formatNumber(t.amount) }}
                                    </div>
                                    <div class="t-chevron">‚Ä∫</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile & Settings -->
                <div v-if="currentTab === 'profile'" class="tab-content">
                    <div class="profile-section">
                        <div class="profile-header">
                            <div class="profile-avatar" :style="{ background: userAvatarGradient }">
                                {{ currentUser.name[0] }}
                            </div>
                            <div class="profile-info">
                                <h2 class="profile-name">{{ currentUser.name }}</h2>
                                <p class="profile-email">{{ currentUser.email || 'Premium Member' }}</p>
                                <div class="profile-badge" :class="settings.role">
                                    {{ settings.role.toUpperCase() }} ACCOUNT
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-header">
                                <span class="section-label">PREFERENCES</span>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-item">
                                    <div class="setting-icon">üí±</div>
                                    <div class="setting-content">
                                        <div class="setting-title">Currency</div>
                                        <select v-model="settings.currency" @change="updateSettings" class="setting-select">
                                            <option value="$">USD ($)</option>
                                            <option value="‚Ç¨">EUR (‚Ç¨)</option>
                                            <option value="¬£">GBP (¬£)</option>
                                            <option value="¬•">JPY (¬•)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="settings-item">
                                    <div class="setting-icon">üé®</div>
                                    <div class="setting-content">
                                        <div class="setting-title">Theme</div>
                                        <div class="theme-options">
                                            <button class="theme-btn active">Dark</button>
                                            <button class="theme-btn" disabled>Light (Coming Soon)</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-item">
                                    <div class="setting-icon">üîî</div>
                                    <div class="setting-content">
                                        <div class="setting-title">Notifications</div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" v-model="settings.notifications" @change="updateSettings">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-header">
                                <span class="section-label">ACCOUNT</span>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-item" @click="exportData">
                                    <div class="setting-icon">üì§</div>
                                    <div class="setting-content">
                                        <div class="setting-title">Export Data</div>
                                        <div class="setting-subtitle">Download your transaction history</div>
                                    </div>
                                    <div class="chevron">‚Ä∫</div>
                                </div>

                                <div class="settings-item" @click="showBackup = true">
                                    <div class="setting-icon">‚òÅÔ∏è</div>
                                    <div class="setting-content">
                                        <div class="setting-title">Backup & Sync</div>
                                        <div class="setting-subtitle">Secure cloud backup</div>
                                    </div>
                                    <div class="chevron">‚Ä∫</div>
                                </div>

                                <div class="settings-item danger" @click="confirmLogout">
                                    <div class="setting-icon">üö™</div>
                                    <div class="setting-content">
                                        <div class="setting-title">Sign Out</div>
                                        <div class="setting-subtitle">Securely exit VaultPro</div>
                                    </div>
                                    <div class="chevron">‚Ä∫</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Enhanced Bottom Navigation -->
            <nav class="bottom-nav">
                <div class="nav-container">
                    <div 
                        class="nav-btn" 
                        :class="{ 'nav-btn-active': currentTab === 'home' }" 
                        @click="setTab('home')"
                    >
                        <div class="nav-icon">üè†</div>
                        <div class="nav-label">Home</div>
                    </div>
                    
                    <div 
                        class="nav-btn" 
                        :class="{ 'nav-btn-active': currentTab === 'list' }" 
                        @click="setTab('list')"
                    >
                        <div class="nav-icon">üìã</div>
                        <div class="nav-label">History</div>
                    </div>
                    
                    <div class="fab-container">
                        <button class="fab-btn" @click="openAdd">
                            <span class="fab-icon">+</span>
                        </button>
                    </div>
                    
                    <div 
                        v-if="isAdmin" 
                        class="nav-btn" 
                        :class="{ 'nav-btn-active': currentTab === 'crypto' }" 
                        @click="setTab('crypto')"
                    >
                        <div class="nav-icon">‚Çø</div>
                        <div class="nav-label">Crypto</div>
                    </div>
                    
                    <div 
                        class="nav-btn" 
                        :class="{ 'nav-btn-active': currentTab === 'profile' }" 
                        @click="setTab('profile')"
                    >
                        <div class="nav-icon">üë§</div>
                        <div class="nav-label">Profile</div>
                    </div>
                </div>
            </nav>

            <!-- Enhanced Transaction Modal -->
            <transition name="modal">
                <div v-if="showModal" class="overlay" @click.self="closeAll">
                    <div class="sheet enhanced">
                        <div class="sheet-handle"></div>
                        
                        <div class="modal-header">
                            <h3>{{ isEditing ? 'Edit Transaction' : 'New Transaction' }}</h3>
                            <button class="close-btn" @click="closeAll">‚úï</button>
                        </div>
                        
                        <div class="amount-section">
                            <div class="currency-symbol">{{ settings.currency }}</div>
                            <input 
                                type="number" 
                                v-model.number="entry.amount" 
                                class="amt-field" 
                                placeholder="0.00" 
                                autofocus
                                step="0.01"
                                min="0"
                            >
                        </div>
                        
                        <div class="category-section">
                            <div class="section-title">Category</div>
                            <div class="cat-scroller">
                                <div 
                                    v-for="c in allCategories" 
                                    :key="c"
                                    :class="['cat-chip', entry.category === c ? 'active' : '']" 
                                    @click="entry.category = c"
                                >
                                    {{ getEmoji(c) }}
                                    <span>{{ c }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-grid">
                                <div class="input-group">
                                    <input 
                                        type="text" 
                                        v-model="entry.notes" 
                                        class="f-input" 
                                        placeholder="Add a note (optional)"
                                        maxlength="50"
                                    >
                                    <span class="input-icon">üìù</span>
                                </div>

                                <div class="input-group">
                                    <input 
                                        type="date" 
                                        v-model="entry.date" 
                                        class="f-input"
                                        :max="todayDate"
                                    >
                                    <span class="input-icon">üìÖ</span>
                                </div>

                                <div v-if="isAdmin && (entry.category === 'Kraken Deposit' || entry.category.includes('Crypto'))" class="input-group">
                                    <input 
                                        type="text" 
                                        v-model="entry.asset" 
                                        class="f-input" 
                                        placeholder="Asset Symbol (e.g., BTC)"
                                        style="text-transform: uppercase;"
                                    >
                                    <span class="input-icon">ü™ô</span>
                                </div>
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button 
                                class="btn-primary" 
                                @click="saveEntry"
                                :disabled="!entry.amount || entry.amount <= 0"
                            >
                                {{ isEditing ? 'Update Transaction' : 'Add Transaction' }}
                            </button>
                            
                            <button 
                                v-if="isEditing" 
                                @click="confirmDelete" 
                                class="btn-delete"
                            >
                                Delete Transaction
                            </button>
                        </div>
                    </div>
                </div>
            </transition>
        </template>

        <!-- Enhanced Toast Notifications -->
        <transition name="toast">
            <div v-if="toastMsg" class="toast-notify enhanced" :class="toastType">
                <div class="toast-icon">{{ toastIcon }}</div>
                <div class="toast-content">{{ toastMsg }}</div>
            </div>
        </transition>

        <!-- Confirmation Modal -->
        <transition name="modal">
            <div v-if="showConfirm" class="overlay">
                <div class="confirm-modal">
                    <div class="confirm-icon">‚ö†Ô∏è</div>
                    <div class="confirm-title">{{ confirmTitle }}</div>
                    <div class="confirm-message">{{ confirmMessage }}</div>
                    <div class="confirm-actions">
                        <button class="btn-cancel" @click="cancelConfirm">Cancel</button>
                        <button class="btn-confirm" @click="proceedConfirm">{{ confirmAction }}</button>
                    </div>
                </div>
            </div>
        </transition>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>